<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>è²“è²“å¦å…‹å¤§æˆ°</title>
<style>
body { margin:0; background:#222; }
canvas { display:block; margin:auto; background:#87ceeb; }
</style>
</head>
<body>

<canvas id="game" width="800" height="500"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ================= ğŸ”Š éŸ³æ•ˆ ================= */
const sndMeow = new Audio("sound/meow.mp3");
const sndHit  = new Audio("sound/hit.mp3");
const sndEat  = new Audio("sound/eat.mp3");

/* ================= ğŸ–¼ï¸ åœ–ç‰‡ ================= */
// ğŸ± a åœ–ï¼šè²“è²“
const imgPlayer = new Image();
imgPlayer.src = "img/player.png";

// ğŸ¤– æ•µäºº
const imgEnemy = new Image();
imgEnemy.src = "img/enemy.png";

// ğŸŸ b åœ–ï¼šé­š
const imgFish = new Image();
imgFish.src = "img/fish.png";

// ğŸ’¥ c åœ–ï¼šçˆ†ç‚¸
const imgBoom = new Image();
imgBoom.src = "img/explosion.png";

/* ================= ğŸ± ç©å®¶ ================= */
const player = {
  x:400, y:250,
  speed:4,
  hp:100,
  maxHp:100
};

/* ================= ğŸ“¦ ç‰©ä»¶ ================= */
let bullets = [];
let enemies = [];
let fishes = [];
let explosions = [];

/* ================= âŒ¨ï¸ æ“ä½œ ================= */
const keys = {};
document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

/* ================= ğŸ¤– ç”Ÿæˆ ================= */
function spawnEnemy(){
  enemies.push({
    x:Math.random()*760+20,
    y:Math.random()*460+20,
    speed:1.3,
    alive:true
  });
}
function spawnFish(){
  fishes.push({
    x:Math.random()*760+20,
    y:Math.random()*460+20
  });
}
for(let i=0;i<5;i++) spawnEnemy();
for(let i=0;i<3;i++) spawnFish();

/* ================= ğŸ’¥ å°„æ“Š ================= */
function shoot(){
  bullets.push({x:player.x, y:player.y, speed:7});
  sndMeow.currentTime = 0;
  sndMeow.play();
}

/* ================= ğŸ”„ æ›´æ–° ================= */
function update(){
  // WASD
  if(keys["w"]) player.y -= player.speed;
  if(keys["s"]) player.y += player.speed;
  if(keys["a"]) player.x -= player.speed;
  if(keys["d"]) player.x += player.speed;

  // å°„æ“Š
  if(keys[" "] && bullets.length < 5){
    shoot();
    keys[" "] = false;
  }

  // å­å½ˆ
  bullets.forEach(b => b.y -= b.speed);
  bullets = bullets.filter(b => b.y > 0);

  // ğŸ¤– æ•µäººè¿½è¹¤
  enemies.forEach(e=>{
    if(!e.alive) return;
    const dx = player.x - e.x;
    const dy = player.y - e.y;
    const d = Math.hypot(dx,dy);
    e.x += dx/d * e.speed;
    e.y += dy/d * e.speed;

    if(d < 26){
      player.hp -= 0.3;
      sndHit.currentTime = 0;
      sndHit.play();
    }
  });

  // ğŸ’¥ å­å½ˆå‘½ä¸­
  bullets.forEach((b,bi)=>{
    enemies.forEach(e=>{
      if(e.alive && Math.abs(b.x-e.x)<20 && Math.abs(b.y-e.y)<20){
        e.alive=false;
        bullets.splice(bi,1);
        explosions.push({x:e.x,y:e.y,r:5});
        spawnEnemy();
      }
    });
  });

  // ğŸ’¥ çˆ†ç‚¸å‹•ç•«
  explosions.forEach(ex=>ex.r+=2);
  explosions = explosions.filter(ex=>ex.r<40);

  // ğŸŸ åƒé­šå›è¡€
  fishes.forEach((f,fi)=>{
    if(Math.hypot(player.x-f.x,player.y-f.y)<25){
      player.hp = Math.min(player.maxHp, player.hp+20);
      fishes.splice(fi,1);
      spawnFish();
      sndEat.play();
    }
  });

  if(player.hp <= 0){
    alert("è²“è²“å€’ä¸‹äº† QQ");
    location.reload();
  }
}

/* ================= ğŸ¨ ç¹ªè£½ ================= */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // ğŸ± ç©å®¶ï¼ˆa åœ–ï¼‰
  ctx.drawImage(imgPlayer, player.x-16, player.y-16, 32, 32);

  // â¤ï¸ è¡€é‡æ¢
  ctx.fillStyle="red";
  ctx.fillRect(20,20,200,14);
  ctx.fillStyle="lime";
  ctx.fillRect(20,20,200*(player.hp/player.maxHp),14);
  ctx.strokeRect(20,20,200,14);

  // ğŸ’¥ å­å½ˆ
  ctx.fillStyle="yellow";
  bullets.forEach(b=>ctx.fillRect(b.x-2,b.y-6,4,8));

  // ğŸ¤– æ•µäºº
  enemies.forEach(e=>{
    if(e.alive)
      ctx.drawImage(imgEnemy, e.x-16, e.y-16, 32, 32);
  });

  // ğŸŸ é­šï¼ˆb åœ–ï¼‰
  fishes.forEach(f=>{
    ctx.drawImage(imgFish, f.x-12, f.y-12, 24, 24);
  });

  // ğŸ’¥ çˆ†ç‚¸ï¼ˆc åœ–ï¼‰
  explosions.forEach(ex=>{
    ctx.drawImage(imgBoom, ex.x-ex.r, ex.y-ex.r, ex.r*2, ex.r*2);
  });
}

/* ================= â–¶ï¸ ä¸»è¿´åœˆ ================= */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
